##Code to replicate the key statistical models in the manuscript 
#"Exploration-exploitation and suicidal behavior in borderline personality and depression"
#Aliona Tsypes, Michael N. Hallquist, Angela Ianni, Aleksandra Kaurin,
#Aidan G.C. Wright, & Alexandre Y. Dombrovski

##Load the required packages 
library(readr)
library(dplyr)
library(tidyverse)
library(lme4)
library(car)
library(lmerTest)

##Set working directory to the location of the following files: BPD_Clock.csv, MDD_Clock.csv, and BPD_EMA.csv
setwd("/Users/alionatsypes/Library/CloudStorage/OneDrive-UniversityofPittsburgh/B Social Clock for R tests/no cutting hundred fifty per run settings/JAMA Psychiatry Clock/Latest files/JAMA P submission_/R1/R2/Files for github")
setwd("")

##BPD sample main results, eTable 4, Fig. 3A
#read in the data file, run the model, evaluate results
BPD_Clock <- read.csv("BPD_Clock.csv")
m1 <- lmer(RT ~ RT_lag*Reward_lag*GroupLethBPD + RTvmax_lag*Trial*GroupLethBPD + RT_lag*Trial*GroupLethBPD + (1|ID/Run), BPD_Clock)
Anova(m1, '3')
summary(m1)

##MDD sample main results, eTable 20, Fig. 3C
#read in the data file, change reference group to high-lethality attempters, run the model, evaluate results
MDD_Clock<-read.csv("MDD_Clock.csv")
MDD_Clock$GroupLethMDD_HL <- relevel(factor(MDD_Clock$GroupLethMDD), ref = 'HL_Attempters')
m2 <- lmer(RT ~ RT_lag*Reward_lag*GroupLethMDD_HL + RTvmax_lag*Trial*GroupLethMDD_HL + RT_lag*Trial*GroupLethMDD_HL + (1|ID/Run), MDD_Clock)
Anova(m2, "3")
summary(m2)

##BPD sample (subsample of EMA completers) main results, eTable 22, Fig. 3D
#read in the data file, run the model, evaluate results
BPD_EMA <- read_csv("BPD_EMA.csv")
m3 <- lmer(RT ~ RT_lag*Reward_lag*scale(SI) + RTvmax_lag*Trial*scale(SI) + RT_lag*Trial*scale(SI)+ (1|ID/Run), BPD_EMA)
Anova(m3, "3")
summary (m3)


















